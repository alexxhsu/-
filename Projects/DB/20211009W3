{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 114,
   "id": "2e745945-d168-4dea-814d-b07fb045055f",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas\n",
    "from glob import glob \n",
    "import numpy"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 115,
   "id": "521bee51-9068-4b06-a811-e0eab16aa136",
   "metadata": {},
   "outputs": [],
   "source": [
    "from pandasql import sqldf\n",
    "pysqldf = lambda q : sqldf(q, globals())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 116,
   "id": "e7cfe279-0c08-452f-b913-34c4797c945e",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['/Users/justin/Projects/DB/data/IBM-Stocks/IBM-2018.csv',\n",
       " '/Users/justin/Projects/DB/data/IBM-Stocks/IBM-2019.csv',\n",
       " '/Users/justin/Projects/DB/data/IBM-Stocks/IBM-2021.csv',\n",
       " '/Users/justin/Projects/DB/data/IBM-Stocks/IBM-2020.csv',\n",
       " '/Users/justin/Projects/DB/data/IBM-Stocks/IBM-2017.csv']"
      ]
     },
     "execution_count": 116,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data_folder=\"/Users/justin/Projects/DB/data/IBM-Stocks\"\n",
    "data_files=glob(\"%s/IBM-20??.csv\" % data_folder)\n",
    "data_files"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 117,
   "id": "6a79029f-b155-41f6-870e-88e32d221e02",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Date</th>\n",
       "      <th>Open</th>\n",
       "      <th>High</th>\n",
       "      <th>Low</th>\n",
       "      <th>Close</th>\n",
       "      <th>Adj Close</th>\n",
       "      <th>Volume</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2021-01-04</td>\n",
       "      <td>125.849998</td>\n",
       "      <td>125.919998</td>\n",
       "      <td>123.040001</td>\n",
       "      <td>123.940002</td>\n",
       "      <td>119.577530</td>\n",
       "      <td>5179200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2021-01-05</td>\n",
       "      <td>125.010002</td>\n",
       "      <td>126.680000</td>\n",
       "      <td>124.610001</td>\n",
       "      <td>126.139999</td>\n",
       "      <td>121.700096</td>\n",
       "      <td>6114600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2021-01-06</td>\n",
       "      <td>126.900002</td>\n",
       "      <td>131.880005</td>\n",
       "      <td>126.720001</td>\n",
       "      <td>129.289993</td>\n",
       "      <td>124.739220</td>\n",
       "      <td>7956700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2021-01-07</td>\n",
       "      <td>130.039993</td>\n",
       "      <td>130.460007</td>\n",
       "      <td>128.259995</td>\n",
       "      <td>128.990005</td>\n",
       "      <td>124.449783</td>\n",
       "      <td>4507400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2021-01-08</td>\n",
       "      <td>128.570007</td>\n",
       "      <td>129.320007</td>\n",
       "      <td>126.980003</td>\n",
       "      <td>128.529999</td>\n",
       "      <td>124.005974</td>\n",
       "      <td>4676200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>176</th>\n",
       "      <td>2021-09-15</td>\n",
       "      <td>136.220001</td>\n",
       "      <td>137.800003</td>\n",
       "      <td>135.669998</td>\n",
       "      <td>137.199997</td>\n",
       "      <td>137.199997</td>\n",
       "      <td>3253900</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>177</th>\n",
       "      <td>2021-09-16</td>\n",
       "      <td>137.279999</td>\n",
       "      <td>137.949997</td>\n",
       "      <td>135.710007</td>\n",
       "      <td>136.429993</td>\n",
       "      <td>136.429993</td>\n",
       "      <td>2644000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>178</th>\n",
       "      <td>2021-09-17</td>\n",
       "      <td>135.750000</td>\n",
       "      <td>135.919998</td>\n",
       "      <td>135.050003</td>\n",
       "      <td>135.229996</td>\n",
       "      <td>135.229996</td>\n",
       "      <td>5631300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>179</th>\n",
       "      <td>2021-09-20</td>\n",
       "      <td>133.899994</td>\n",
       "      <td>135.179993</td>\n",
       "      <td>132.779999</td>\n",
       "      <td>134.309998</td>\n",
       "      <td>134.309998</td>\n",
       "      <td>4770700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>180</th>\n",
       "      <td>2021-09-21</td>\n",
       "      <td>135.110001</td>\n",
       "      <td>135.639999</td>\n",
       "      <td>132.869995</td>\n",
       "      <td>132.970001</td>\n",
       "      <td>132.970001</td>\n",
       "      <td>4042768</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>181 rows × 7 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "           Date        Open        High         Low       Close   Adj Close  \\\n",
       "0    2021-01-04  125.849998  125.919998  123.040001  123.940002  119.577530   \n",
       "1    2021-01-05  125.010002  126.680000  124.610001  126.139999  121.700096   \n",
       "2    2021-01-06  126.900002  131.880005  126.720001  129.289993  124.739220   \n",
       "3    2021-01-07  130.039993  130.460007  128.259995  128.990005  124.449783   \n",
       "4    2021-01-08  128.570007  129.320007  126.980003  128.529999  124.005974   \n",
       "..          ...         ...         ...         ...         ...         ...   \n",
       "176  2021-09-15  136.220001  137.800003  135.669998  137.199997  137.199997   \n",
       "177  2021-09-16  137.279999  137.949997  135.710007  136.429993  136.429993   \n",
       "178  2021-09-17  135.750000  135.919998  135.050003  135.229996  135.229996   \n",
       "179  2021-09-20  133.899994  135.179993  132.779999  134.309998  134.309998   \n",
       "180  2021-09-21  135.110001  135.639999  132.869995  132.970001  132.970001   \n",
       "\n",
       "      Volume  \n",
       "0    5179200  \n",
       "1    6114600  \n",
       "2    7956700  \n",
       "3    4507400  \n",
       "4    4676200  \n",
       "..       ...  \n",
       "176  3253900  \n",
       "177  2644000  \n",
       "178  5631300  \n",
       "179  4770700  \n",
       "180  4042768  \n",
       "\n",
       "[181 rows x 7 columns]"
      ]
     },
     "execution_count": 117,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_file= numpy.random.randint(0,len(data_files))\n",
    "dataframe_2k=pandas.read_csv(data_files[my_file])\n",
    "dataframe_2k"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ff9cf0e1-b580-437e-a1f5-9db1f6b9fc57",
   "metadata": {},
   "source": [
    "查詢字串欄位包含某樣式資料 substr 第幾個欄位開始讀date 第幾個開始5第五個開始讀 讀四碼 ％s字串格式化輸出 my_month ＊讀全部"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 118,
   "id": "18fa1bbf-11d6-4b64-93b0-290b8288a089",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Date</th>\n",
       "      <th>Open</th>\n",
       "      <th>High</th>\n",
       "      <th>Low</th>\n",
       "      <th>Close</th>\n",
       "      <th>Adj Close</th>\n",
       "      <th>Volume</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2021-01-04</td>\n",
       "      <td>125.849998</td>\n",
       "      <td>125.919998</td>\n",
       "      <td>123.040001</td>\n",
       "      <td>123.940002</td>\n",
       "      <td>119.577530</td>\n",
       "      <td>5179200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2021-01-05</td>\n",
       "      <td>125.010002</td>\n",
       "      <td>126.680000</td>\n",
       "      <td>124.610001</td>\n",
       "      <td>126.139999</td>\n",
       "      <td>121.700096</td>\n",
       "      <td>6114600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2021-01-06</td>\n",
       "      <td>126.900002</td>\n",
       "      <td>131.880005</td>\n",
       "      <td>126.720001</td>\n",
       "      <td>129.289993</td>\n",
       "      <td>124.739220</td>\n",
       "      <td>7956700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2021-01-07</td>\n",
       "      <td>130.039993</td>\n",
       "      <td>130.460007</td>\n",
       "      <td>128.259995</td>\n",
       "      <td>128.990005</td>\n",
       "      <td>124.449783</td>\n",
       "      <td>4507400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2021-01-08</td>\n",
       "      <td>128.570007</td>\n",
       "      <td>129.320007</td>\n",
       "      <td>126.980003</td>\n",
       "      <td>128.529999</td>\n",
       "      <td>124.005974</td>\n",
       "      <td>4676200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2021-01-11</td>\n",
       "      <td>127.949997</td>\n",
       "      <td>129.679993</td>\n",
       "      <td>127.660004</td>\n",
       "      <td>128.580002</td>\n",
       "      <td>124.054214</td>\n",
       "      <td>5601900</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2021-01-12</td>\n",
       "      <td>129.089996</td>\n",
       "      <td>129.850006</td>\n",
       "      <td>127.940002</td>\n",
       "      <td>129.210007</td>\n",
       "      <td>124.662048</td>\n",
       "      <td>3749200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2021-01-13</td>\n",
       "      <td>129.149994</td>\n",
       "      <td>129.750000</td>\n",
       "      <td>126.459999</td>\n",
       "      <td>126.919998</td>\n",
       "      <td>122.452644</td>\n",
       "      <td>7677700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2021-01-14</td>\n",
       "      <td>128.020004</td>\n",
       "      <td>130.160004</td>\n",
       "      <td>127.550003</td>\n",
       "      <td>128.970001</td>\n",
       "      <td>124.430489</td>\n",
       "      <td>7503200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2021-01-15</td>\n",
       "      <td>128.279999</td>\n",
       "      <td>129.240005</td>\n",
       "      <td>127.669998</td>\n",
       "      <td>128.389999</td>\n",
       "      <td>123.870895</td>\n",
       "      <td>4905500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>2021-01-19</td>\n",
       "      <td>129.279999</td>\n",
       "      <td>129.589996</td>\n",
       "      <td>128.089996</td>\n",
       "      <td>129.020004</td>\n",
       "      <td>124.478729</td>\n",
       "      <td>5398000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>2021-01-20</td>\n",
       "      <td>129.699997</td>\n",
       "      <td>131.059998</td>\n",
       "      <td>128.559998</td>\n",
       "      <td>130.080002</td>\n",
       "      <td>125.501419</td>\n",
       "      <td>5598700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>2021-01-21</td>\n",
       "      <td>130.119995</td>\n",
       "      <td>132.240005</td>\n",
       "      <td>130.050003</td>\n",
       "      <td>131.649994</td>\n",
       "      <td>127.016144</td>\n",
       "      <td>12539200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>2021-01-22</td>\n",
       "      <td>120.699997</td>\n",
       "      <td>120.699997</td>\n",
       "      <td>117.360001</td>\n",
       "      <td>118.610001</td>\n",
       "      <td>114.435143</td>\n",
       "      <td>38063500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>2021-01-25</td>\n",
       "      <td>118.760002</td>\n",
       "      <td>119.540001</td>\n",
       "      <td>117.449997</td>\n",
       "      <td>118.580002</td>\n",
       "      <td>114.406197</td>\n",
       "      <td>13686400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>2021-01-26</td>\n",
       "      <td>119.180000</td>\n",
       "      <td>122.589996</td>\n",
       "      <td>118.419998</td>\n",
       "      <td>122.489998</td>\n",
       "      <td>118.178566</td>\n",
       "      <td>10694700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>2021-01-27</td>\n",
       "      <td>122.080002</td>\n",
       "      <td>124.790001</td>\n",
       "      <td>121.620003</td>\n",
       "      <td>122.470001</td>\n",
       "      <td>118.159271</td>\n",
       "      <td>12146500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>2021-01-28</td>\n",
       "      <td>122.800003</td>\n",
       "      <td>123.199997</td>\n",
       "      <td>120.070000</td>\n",
       "      <td>120.080002</td>\n",
       "      <td>115.853401</td>\n",
       "      <td>8084100</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>2021-01-29</td>\n",
       "      <td>120.220001</td>\n",
       "      <td>121.300003</td>\n",
       "      <td>118.900002</td>\n",
       "      <td>119.110001</td>\n",
       "      <td>114.917534</td>\n",
       "      <td>11825500</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          Date        Open        High         Low       Close   Adj Close  \\\n",
       "0   2021-01-04  125.849998  125.919998  123.040001  123.940002  119.577530   \n",
       "1   2021-01-05  125.010002  126.680000  124.610001  126.139999  121.700096   \n",
       "2   2021-01-06  126.900002  131.880005  126.720001  129.289993  124.739220   \n",
       "3   2021-01-07  130.039993  130.460007  128.259995  128.990005  124.449783   \n",
       "4   2021-01-08  128.570007  129.320007  126.980003  128.529999  124.005974   \n",
       "5   2021-01-11  127.949997  129.679993  127.660004  128.580002  124.054214   \n",
       "6   2021-01-12  129.089996  129.850006  127.940002  129.210007  124.662048   \n",
       "7   2021-01-13  129.149994  129.750000  126.459999  126.919998  122.452644   \n",
       "8   2021-01-14  128.020004  130.160004  127.550003  128.970001  124.430489   \n",
       "9   2021-01-15  128.279999  129.240005  127.669998  128.389999  123.870895   \n",
       "10  2021-01-19  129.279999  129.589996  128.089996  129.020004  124.478729   \n",
       "11  2021-01-20  129.699997  131.059998  128.559998  130.080002  125.501419   \n",
       "12  2021-01-21  130.119995  132.240005  130.050003  131.649994  127.016144   \n",
       "13  2021-01-22  120.699997  120.699997  117.360001  118.610001  114.435143   \n",
       "14  2021-01-25  118.760002  119.540001  117.449997  118.580002  114.406197   \n",
       "15  2021-01-26  119.180000  122.589996  118.419998  122.489998  118.178566   \n",
       "16  2021-01-27  122.080002  124.790001  121.620003  122.470001  118.159271   \n",
       "17  2021-01-28  122.800003  123.199997  120.070000  120.080002  115.853401   \n",
       "18  2021-01-29  120.220001  121.300003  118.900002  119.110001  114.917534   \n",
       "\n",
       "      Volume  \n",
       "0    5179200  \n",
       "1    6114600  \n",
       "2    7956700  \n",
       "3    4507400  \n",
       "4    4676200  \n",
       "5    5601900  \n",
       "6    3749200  \n",
       "7    7677700  \n",
       "8    7503200  \n",
       "9    4905500  \n",
       "10   5398000  \n",
       "11   5598700  \n",
       "12  12539200  \n",
       "13  38063500  \n",
       "14  13686400  \n",
       "15  10694700  \n",
       "16  12146500  \n",
       "17   8084100  \n",
       "18  11825500  "
      ]
     },
     "execution_count": 118,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_month= '-%02d-' % numpy.random.randint(1,12)\n",
    "my_monthy= pysqldf(\"SELECT * FROM dataframe_2k WHERE SUBSTR(Date, 5, 4)= '%s' ;\"  %my_month) \n",
    "my_monthy"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 119,
   "id": "cb1b301b-b05d-495e-b07e-1b5d7baa351b",
   "metadata": {},
   "outputs": [],
   "source": [
    "my_monly_stats =(my_monthy['Open'].mean(),my_monthy['Open'].std())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 120,
   "id": "5d895dfa-b551-4f6f-a631-9ae17efff581",
   "metadata": {},
   "outputs": [],
   "source": [
    "my_monly_stats2 =(my_monthy['Volume'].mean(),my_monthy['Volume'].std())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 121,
   "id": "e458b82f-9ca7-4a1c-8e6e-3d9165954176",
   "metadata": {},
   "outputs": [],
   "source": [
    "my_Base_SQL =\"SELECT * FROM dataframe_2k \""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 122,
   "id": "aa9e2204-d79b-439f-8e16-a7ddda32c700",
   "metadata": {},
   "outputs": [],
   "source": [
    "my_month= '-%02d-' % numpy.random.randint(1,12)\n",
    "my_monthy= pysqldf(\"%s WHERE SUBSTR(Date, 5, 4)= '%s' ;\"% ( my_Base_SQL, my_month)) "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "aa1e8e34-f650-4e9d-bf19-fb79115a7d3e",
   "metadata": {},
   "source": [
    "%s第一個 格式化輸出 my_Base_SQL"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 123,
   "id": "b36bc021-de90-46fa-87fe-f335df72e7cf",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'SELECT * FROM dataframe_2k  WHERE OPEN < %s;'"
      ]
     },
     "execution_count": 123,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_SQL = my_Base_SQL + ' WHERE OPEN < %s;'\n",
    "my_SQL"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a8fe4f42-e0d4-46f8-bb80-9ddfbaf0c00d",
   "metadata": {},
   "source": [
    "WHERE OPEN條件"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 124,
   "id": "8dbc2639-3f2d-411e-987b-352b46afad08",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'SELECT * FROM dataframe_2k  WHERE OPEN < 127.86665193073038;'"
      ]
     },
     "execution_count": 124,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_SQL_statement =my_SQL % str(my_monly_stats[0]+0.5 *my_monly_stats[1])\n",
    "my_SQL_statement"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 125,
   "id": "ca9dc09e-c186-4921-86e6-2a784838da49",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Date</th>\n",
       "      <th>Open</th>\n",
       "      <th>High</th>\n",
       "      <th>Low</th>\n",
       "      <th>Close</th>\n",
       "      <th>Adj Close</th>\n",
       "      <th>Volume</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2021-01-04</td>\n",
       "      <td>125.849998</td>\n",
       "      <td>125.919998</td>\n",
       "      <td>123.040001</td>\n",
       "      <td>123.940002</td>\n",
       "      <td>119.577530</td>\n",
       "      <td>5179200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2021-01-05</td>\n",
       "      <td>125.010002</td>\n",
       "      <td>126.680000</td>\n",
       "      <td>124.610001</td>\n",
       "      <td>126.139999</td>\n",
       "      <td>121.700096</td>\n",
       "      <td>6114600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2021-01-06</td>\n",
       "      <td>126.900002</td>\n",
       "      <td>131.880005</td>\n",
       "      <td>126.720001</td>\n",
       "      <td>129.289993</td>\n",
       "      <td>124.739220</td>\n",
       "      <td>7956700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2021-01-22</td>\n",
       "      <td>120.699997</td>\n",
       "      <td>120.699997</td>\n",
       "      <td>117.360001</td>\n",
       "      <td>118.610001</td>\n",
       "      <td>114.435143</td>\n",
       "      <td>38063500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2021-01-25</td>\n",
       "      <td>118.760002</td>\n",
       "      <td>119.540001</td>\n",
       "      <td>117.449997</td>\n",
       "      <td>118.580002</td>\n",
       "      <td>114.406197</td>\n",
       "      <td>13686400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2021-01-26</td>\n",
       "      <td>119.180000</td>\n",
       "      <td>122.589996</td>\n",
       "      <td>118.419998</td>\n",
       "      <td>122.489998</td>\n",
       "      <td>118.178566</td>\n",
       "      <td>10694700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2021-01-27</td>\n",
       "      <td>122.080002</td>\n",
       "      <td>124.790001</td>\n",
       "      <td>121.620003</td>\n",
       "      <td>122.470001</td>\n",
       "      <td>118.159271</td>\n",
       "      <td>12146500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2021-01-28</td>\n",
       "      <td>122.800003</td>\n",
       "      <td>123.199997</td>\n",
       "      <td>120.070000</td>\n",
       "      <td>120.080002</td>\n",
       "      <td>115.853401</td>\n",
       "      <td>8084100</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2021-01-29</td>\n",
       "      <td>120.220001</td>\n",
       "      <td>121.300003</td>\n",
       "      <td>118.900002</td>\n",
       "      <td>119.110001</td>\n",
       "      <td>114.917534</td>\n",
       "      <td>11825500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2021-02-01</td>\n",
       "      <td>119.900002</td>\n",
       "      <td>120.949997</td>\n",
       "      <td>118.730003</td>\n",
       "      <td>120.540001</td>\n",
       "      <td>116.297203</td>\n",
       "      <td>6250500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>2021-02-02</td>\n",
       "      <td>119.360001</td>\n",
       "      <td>121.000000</td>\n",
       "      <td>119.279999</td>\n",
       "      <td>119.440002</td>\n",
       "      <td>115.235931</td>\n",
       "      <td>6341900</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>2021-02-03</td>\n",
       "      <td>119.040001</td>\n",
       "      <td>119.800003</td>\n",
       "      <td>118.120003</td>\n",
       "      <td>119.120003</td>\n",
       "      <td>114.927193</td>\n",
       "      <td>6715400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>2021-02-04</td>\n",
       "      <td>119.910004</td>\n",
       "      <td>121.099998</td>\n",
       "      <td>118.870003</td>\n",
       "      <td>121.019997</td>\n",
       "      <td>116.760307</td>\n",
       "      <td>4562100</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>2021-02-05</td>\n",
       "      <td>121.000000</td>\n",
       "      <td>121.809998</td>\n",
       "      <td>120.519997</td>\n",
       "      <td>121.790001</td>\n",
       "      <td>117.503204</td>\n",
       "      <td>4565700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>2021-02-08</td>\n",
       "      <td>122.620003</td>\n",
       "      <td>123.980003</td>\n",
       "      <td>122.400002</td>\n",
       "      <td>123.610001</td>\n",
       "      <td>119.259148</td>\n",
       "      <td>5888000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>2021-02-09</td>\n",
       "      <td>121.900002</td>\n",
       "      <td>122.599998</td>\n",
       "      <td>121.050003</td>\n",
       "      <td>122.099998</td>\n",
       "      <td>119.376472</td>\n",
       "      <td>4717000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>2021-02-10</td>\n",
       "      <td>123.029999</td>\n",
       "      <td>123.410004</td>\n",
       "      <td>121.209999</td>\n",
       "      <td>122.239998</td>\n",
       "      <td>119.513344</td>\n",
       "      <td>4866800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>2021-02-11</td>\n",
       "      <td>122.000000</td>\n",
       "      <td>122.209999</td>\n",
       "      <td>120.629997</td>\n",
       "      <td>120.910004</td>\n",
       "      <td>118.213020</td>\n",
       "      <td>5381600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>2021-02-12</td>\n",
       "      <td>121.000000</td>\n",
       "      <td>121.360001</td>\n",
       "      <td>120.089996</td>\n",
       "      <td>120.800003</td>\n",
       "      <td>118.105469</td>\n",
       "      <td>3871200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>2021-02-16</td>\n",
       "      <td>120.150002</td>\n",
       "      <td>120.599998</td>\n",
       "      <td>119.360001</td>\n",
       "      <td>120.070000</td>\n",
       "      <td>117.391747</td>\n",
       "      <td>6639800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>2021-02-17</td>\n",
       "      <td>119.269997</td>\n",
       "      <td>120.559998</td>\n",
       "      <td>119.019997</td>\n",
       "      <td>119.970001</td>\n",
       "      <td>117.293983</td>\n",
       "      <td>3959100</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>2021-02-18</td>\n",
       "      <td>120.500000</td>\n",
       "      <td>120.940002</td>\n",
       "      <td>119.699997</td>\n",
       "      <td>120.730003</td>\n",
       "      <td>118.037033</td>\n",
       "      <td>5398100</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>2021-02-19</td>\n",
       "      <td>120.750000</td>\n",
       "      <td>120.760002</td>\n",
       "      <td>118.379997</td>\n",
       "      <td>118.989998</td>\n",
       "      <td>116.335838</td>\n",
       "      <td>6578700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>2021-02-22</td>\n",
       "      <td>118.500000</td>\n",
       "      <td>121.129997</td>\n",
       "      <td>118.440002</td>\n",
       "      <td>120.860001</td>\n",
       "      <td>118.164131</td>\n",
       "      <td>5879200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>2021-02-23</td>\n",
       "      <td>120.919998</td>\n",
       "      <td>121.349998</td>\n",
       "      <td>119.800003</td>\n",
       "      <td>120.709999</td>\n",
       "      <td>118.017471</td>\n",
       "      <td>4531300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>2021-02-24</td>\n",
       "      <td>120.800003</td>\n",
       "      <td>123.489998</td>\n",
       "      <td>120.519997</td>\n",
       "      <td>123.209999</td>\n",
       "      <td>120.461708</td>\n",
       "      <td>5820000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>2021-02-25</td>\n",
       "      <td>123.370003</td>\n",
       "      <td>124.349998</td>\n",
       "      <td>122.339996</td>\n",
       "      <td>122.470001</td>\n",
       "      <td>119.738220</td>\n",
       "      <td>5691800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>2021-02-26</td>\n",
       "      <td>122.250000</td>\n",
       "      <td>122.250000</td>\n",
       "      <td>118.879997</td>\n",
       "      <td>118.930000</td>\n",
       "      <td>116.277176</td>\n",
       "      <td>9051000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>2021-03-01</td>\n",
       "      <td>120.349998</td>\n",
       "      <td>122.320000</td>\n",
       "      <td>119.860001</td>\n",
       "      <td>120.739998</td>\n",
       "      <td>118.046806</td>\n",
       "      <td>5714500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>2021-03-02</td>\n",
       "      <td>120.739998</td>\n",
       "      <td>121.900002</td>\n",
       "      <td>120.260002</td>\n",
       "      <td>120.330002</td>\n",
       "      <td>117.645958</td>\n",
       "      <td>4524300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>2021-03-03</td>\n",
       "      <td>120.500000</td>\n",
       "      <td>122.629997</td>\n",
       "      <td>119.980003</td>\n",
       "      <td>122.360001</td>\n",
       "      <td>119.630669</td>\n",
       "      <td>7404300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>2021-03-04</td>\n",
       "      <td>122.000000</td>\n",
       "      <td>123.220001</td>\n",
       "      <td>118.760002</td>\n",
       "      <td>120.110001</td>\n",
       "      <td>117.430855</td>\n",
       "      <td>8068500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>2021-03-05</td>\n",
       "      <td>120.639999</td>\n",
       "      <td>123.750000</td>\n",
       "      <td>120.250000</td>\n",
       "      <td>122.830002</td>\n",
       "      <td>120.090195</td>\n",
       "      <td>6949300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>2021-03-08</td>\n",
       "      <td>122.989998</td>\n",
       "      <td>126.849998</td>\n",
       "      <td>122.879997</td>\n",
       "      <td>124.809998</td>\n",
       "      <td>122.026016</td>\n",
       "      <td>7239200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>2021-03-09</td>\n",
       "      <td>125.400002</td>\n",
       "      <td>126.430000</td>\n",
       "      <td>124.160004</td>\n",
       "      <td>124.180000</td>\n",
       "      <td>121.410080</td>\n",
       "      <td>5609000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>2021-03-10</td>\n",
       "      <td>125.050003</td>\n",
       "      <td>128.240005</td>\n",
       "      <td>124.610001</td>\n",
       "      <td>127.870003</td>\n",
       "      <td>125.017769</td>\n",
       "      <td>7247800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>2021-03-12</td>\n",
       "      <td>127.190002</td>\n",
       "      <td>127.680000</td>\n",
       "      <td>126.610001</td>\n",
       "      <td>127.610001</td>\n",
       "      <td>124.763565</td>\n",
       "      <td>4010100</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>2021-03-15</td>\n",
       "      <td>127.769997</td>\n",
       "      <td>128.750000</td>\n",
       "      <td>127.540001</td>\n",
       "      <td>128.580002</td>\n",
       "      <td>125.711929</td>\n",
       "      <td>3420600</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          Date        Open        High         Low       Close   Adj Close  \\\n",
       "0   2021-01-04  125.849998  125.919998  123.040001  123.940002  119.577530   \n",
       "1   2021-01-05  125.010002  126.680000  124.610001  126.139999  121.700096   \n",
       "2   2021-01-06  126.900002  131.880005  126.720001  129.289993  124.739220   \n",
       "3   2021-01-22  120.699997  120.699997  117.360001  118.610001  114.435143   \n",
       "4   2021-01-25  118.760002  119.540001  117.449997  118.580002  114.406197   \n",
       "5   2021-01-26  119.180000  122.589996  118.419998  122.489998  118.178566   \n",
       "6   2021-01-27  122.080002  124.790001  121.620003  122.470001  118.159271   \n",
       "7   2021-01-28  122.800003  123.199997  120.070000  120.080002  115.853401   \n",
       "8   2021-01-29  120.220001  121.300003  118.900002  119.110001  114.917534   \n",
       "9   2021-02-01  119.900002  120.949997  118.730003  120.540001  116.297203   \n",
       "10  2021-02-02  119.360001  121.000000  119.279999  119.440002  115.235931   \n",
       "11  2021-02-03  119.040001  119.800003  118.120003  119.120003  114.927193   \n",
       "12  2021-02-04  119.910004  121.099998  118.870003  121.019997  116.760307   \n",
       "13  2021-02-05  121.000000  121.809998  120.519997  121.790001  117.503204   \n",
       "14  2021-02-08  122.620003  123.980003  122.400002  123.610001  119.259148   \n",
       "15  2021-02-09  121.900002  122.599998  121.050003  122.099998  119.376472   \n",
       "16  2021-02-10  123.029999  123.410004  121.209999  122.239998  119.513344   \n",
       "17  2021-02-11  122.000000  122.209999  120.629997  120.910004  118.213020   \n",
       "18  2021-02-12  121.000000  121.360001  120.089996  120.800003  118.105469   \n",
       "19  2021-02-16  120.150002  120.599998  119.360001  120.070000  117.391747   \n",
       "20  2021-02-17  119.269997  120.559998  119.019997  119.970001  117.293983   \n",
       "21  2021-02-18  120.500000  120.940002  119.699997  120.730003  118.037033   \n",
       "22  2021-02-19  120.750000  120.760002  118.379997  118.989998  116.335838   \n",
       "23  2021-02-22  118.500000  121.129997  118.440002  120.860001  118.164131   \n",
       "24  2021-02-23  120.919998  121.349998  119.800003  120.709999  118.017471   \n",
       "25  2021-02-24  120.800003  123.489998  120.519997  123.209999  120.461708   \n",
       "26  2021-02-25  123.370003  124.349998  122.339996  122.470001  119.738220   \n",
       "27  2021-02-26  122.250000  122.250000  118.879997  118.930000  116.277176   \n",
       "28  2021-03-01  120.349998  122.320000  119.860001  120.739998  118.046806   \n",
       "29  2021-03-02  120.739998  121.900002  120.260002  120.330002  117.645958   \n",
       "30  2021-03-03  120.500000  122.629997  119.980003  122.360001  119.630669   \n",
       "31  2021-03-04  122.000000  123.220001  118.760002  120.110001  117.430855   \n",
       "32  2021-03-05  120.639999  123.750000  120.250000  122.830002  120.090195   \n",
       "33  2021-03-08  122.989998  126.849998  122.879997  124.809998  122.026016   \n",
       "34  2021-03-09  125.400002  126.430000  124.160004  124.180000  121.410080   \n",
       "35  2021-03-10  125.050003  128.240005  124.610001  127.870003  125.017769   \n",
       "36  2021-03-12  127.190002  127.680000  126.610001  127.610001  124.763565   \n",
       "37  2021-03-15  127.769997  128.750000  127.540001  128.580002  125.711929   \n",
       "\n",
       "      Volume  \n",
       "0    5179200  \n",
       "1    6114600  \n",
       "2    7956700  \n",
       "3   38063500  \n",
       "4   13686400  \n",
       "5   10694700  \n",
       "6   12146500  \n",
       "7    8084100  \n",
       "8   11825500  \n",
       "9    6250500  \n",
       "10   6341900  \n",
       "11   6715400  \n",
       "12   4562100  \n",
       "13   4565700  \n",
       "14   5888000  \n",
       "15   4717000  \n",
       "16   4866800  \n",
       "17   5381600  \n",
       "18   3871200  \n",
       "19   6639800  \n",
       "20   3959100  \n",
       "21   5398100  \n",
       "22   6578700  \n",
       "23   5879200  \n",
       "24   4531300  \n",
       "25   5820000  \n",
       "26   5691800  \n",
       "27   9051000  \n",
       "28   5714500  \n",
       "29   4524300  \n",
       "30   7404300  \n",
       "31   8068500  \n",
       "32   6949300  \n",
       "33   7239200  \n",
       "34   5609000  \n",
       "35   7247800  \n",
       "36   4010100  \n",
       "37   3420600  "
      ]
     },
     "execution_count": 125,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_monthly_lower= pysqldf(my_SQL_statement)\n",
    "my_monthly_lower"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 126,
   "id": "d4ba8d4e-e741-4147-89d9-9ca379a482d3",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Open</th>\n",
       "      <th>High</th>\n",
       "      <th>Low</th>\n",
       "      <th>Close</th>\n",
       "      <th>Adj Close</th>\n",
       "      <th>Volume</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2021-01-04</th>\n",
       "      <td>125.849998</td>\n",
       "      <td>125.919998</td>\n",
       "      <td>123.040001</td>\n",
       "      <td>123.940002</td>\n",
       "      <td>119.577530</td>\n",
       "      <td>5179200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-05</th>\n",
       "      <td>125.010002</td>\n",
       "      <td>126.680000</td>\n",
       "      <td>124.610001</td>\n",
       "      <td>126.139999</td>\n",
       "      <td>121.700096</td>\n",
       "      <td>6114600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-06</th>\n",
       "      <td>126.900002</td>\n",
       "      <td>131.880005</td>\n",
       "      <td>126.720001</td>\n",
       "      <td>129.289993</td>\n",
       "      <td>124.739220</td>\n",
       "      <td>7956700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-09</th>\n",
       "      <td>125.400002</td>\n",
       "      <td>126.430000</td>\n",
       "      <td>124.160004</td>\n",
       "      <td>124.180000</td>\n",
       "      <td>121.410080</td>\n",
       "      <td>5609000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-10</th>\n",
       "      <td>125.050003</td>\n",
       "      <td>128.240005</td>\n",
       "      <td>124.610001</td>\n",
       "      <td>127.870003</td>\n",
       "      <td>125.017769</td>\n",
       "      <td>7247800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-12</th>\n",
       "      <td>127.190002</td>\n",
       "      <td>127.680000</td>\n",
       "      <td>126.610001</td>\n",
       "      <td>127.610001</td>\n",
       "      <td>124.763565</td>\n",
       "      <td>4010100</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-15</th>\n",
       "      <td>127.769997</td>\n",
       "      <td>128.750000</td>\n",
       "      <td>127.540001</td>\n",
       "      <td>128.580002</td>\n",
       "      <td>125.711929</td>\n",
       "      <td>3420600</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  Open        High         Low       Close   Adj Close  \\\n",
       "Date                                                                     \n",
       "2021-01-04  125.849998  125.919998  123.040001  123.940002  119.577530   \n",
       "2021-01-05  125.010002  126.680000  124.610001  126.139999  121.700096   \n",
       "2021-01-06  126.900002  131.880005  126.720001  129.289993  124.739220   \n",
       "2021-03-09  125.400002  126.430000  124.160004  124.180000  121.410080   \n",
       "2021-03-10  125.050003  128.240005  124.610001  127.870003  125.017769   \n",
       "2021-03-12  127.190002  127.680000  126.610001  127.610001  124.763565   \n",
       "2021-03-15  127.769997  128.750000  127.540001  128.580002  125.711929   \n",
       "\n",
       "             Volume  \n",
       "Date                 \n",
       "2021-01-04  5179200  \n",
       "2021-01-05  6114600  \n",
       "2021-01-06  7956700  \n",
       "2021-03-09  5609000  \n",
       "2021-03-10  7247800  \n",
       "2021-03-12  4010100  \n",
       "2021-03-15  3420600  "
      ]
     },
     "execution_count": 126,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_SQL = my_Base_SQL + \"WHERE OPEN > %s AND Open < %s;\"\n",
    "pysqldf(my_SQL % (\n",
    "    str(my_monly_stats[0]-0.5 *my_monly_stats[1]),my_monly_stats[0]+0.5 *my_monly_stats[1])).set_index([\"Date\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 127,
   "id": "3e6ace86-97ee-4374-86bb-7ea6ced3c0ce",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Open</th>\n",
       "      <th>High</th>\n",
       "      <th>Low</th>\n",
       "      <th>Close</th>\n",
       "      <th>Adj Close</th>\n",
       "      <th>Volume</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2021-01-05</th>\n",
       "      <td>125.010002</td>\n",
       "      <td>126.680000</td>\n",
       "      <td>124.610001</td>\n",
       "      <td>126.139999</td>\n",
       "      <td>121.700096</td>\n",
       "      <td>6114600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-06</th>\n",
       "      <td>126.900002</td>\n",
       "      <td>131.880005</td>\n",
       "      <td>126.720001</td>\n",
       "      <td>129.289993</td>\n",
       "      <td>124.739220</td>\n",
       "      <td>7956700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-11</th>\n",
       "      <td>127.949997</td>\n",
       "      <td>129.679993</td>\n",
       "      <td>127.660004</td>\n",
       "      <td>128.580002</td>\n",
       "      <td>124.054214</td>\n",
       "      <td>5601900</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-13</th>\n",
       "      <td>129.149994</td>\n",
       "      <td>129.750000</td>\n",
       "      <td>126.459999</td>\n",
       "      <td>126.919998</td>\n",
       "      <td>122.452644</td>\n",
       "      <td>7677700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-14</th>\n",
       "      <td>128.020004</td>\n",
       "      <td>130.160004</td>\n",
       "      <td>127.550003</td>\n",
       "      <td>128.970001</td>\n",
       "      <td>124.430489</td>\n",
       "      <td>7503200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-20</th>\n",
       "      <td>129.699997</td>\n",
       "      <td>131.059998</td>\n",
       "      <td>128.559998</td>\n",
       "      <td>130.080002</td>\n",
       "      <td>125.501419</td>\n",
       "      <td>5598700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-21</th>\n",
       "      <td>130.119995</td>\n",
       "      <td>132.240005</td>\n",
       "      <td>130.050003</td>\n",
       "      <td>131.649994</td>\n",
       "      <td>127.016144</td>\n",
       "      <td>12539200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-26</th>\n",
       "      <td>119.180000</td>\n",
       "      <td>122.589996</td>\n",
       "      <td>118.419998</td>\n",
       "      <td>122.489998</td>\n",
       "      <td>118.178566</td>\n",
       "      <td>10694700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-27</th>\n",
       "      <td>122.080002</td>\n",
       "      <td>124.790001</td>\n",
       "      <td>121.620003</td>\n",
       "      <td>122.470001</td>\n",
       "      <td>118.159271</td>\n",
       "      <td>12146500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-28</th>\n",
       "      <td>122.800003</td>\n",
       "      <td>123.199997</td>\n",
       "      <td>120.070000</td>\n",
       "      <td>120.080002</td>\n",
       "      <td>115.853401</td>\n",
       "      <td>8084100</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-29</th>\n",
       "      <td>120.220001</td>\n",
       "      <td>121.300003</td>\n",
       "      <td>118.900002</td>\n",
       "      <td>119.110001</td>\n",
       "      <td>114.917534</td>\n",
       "      <td>11825500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02-01</th>\n",
       "      <td>119.900002</td>\n",
       "      <td>120.949997</td>\n",
       "      <td>118.730003</td>\n",
       "      <td>120.540001</td>\n",
       "      <td>116.297203</td>\n",
       "      <td>6250500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02-02</th>\n",
       "      <td>119.360001</td>\n",
       "      <td>121.000000</td>\n",
       "      <td>119.279999</td>\n",
       "      <td>119.440002</td>\n",
       "      <td>115.235931</td>\n",
       "      <td>6341900</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02-03</th>\n",
       "      <td>119.040001</td>\n",
       "      <td>119.800003</td>\n",
       "      <td>118.120003</td>\n",
       "      <td>119.120003</td>\n",
       "      <td>114.927193</td>\n",
       "      <td>6715400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02-08</th>\n",
       "      <td>122.620003</td>\n",
       "      <td>123.980003</td>\n",
       "      <td>122.400002</td>\n",
       "      <td>123.610001</td>\n",
       "      <td>119.259148</td>\n",
       "      <td>5888000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02-16</th>\n",
       "      <td>120.150002</td>\n",
       "      <td>120.599998</td>\n",
       "      <td>119.360001</td>\n",
       "      <td>120.070000</td>\n",
       "      <td>117.391747</td>\n",
       "      <td>6639800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02-19</th>\n",
       "      <td>120.750000</td>\n",
       "      <td>120.760002</td>\n",
       "      <td>118.379997</td>\n",
       "      <td>118.989998</td>\n",
       "      <td>116.335838</td>\n",
       "      <td>6578700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02-22</th>\n",
       "      <td>118.500000</td>\n",
       "      <td>121.129997</td>\n",
       "      <td>118.440002</td>\n",
       "      <td>120.860001</td>\n",
       "      <td>118.164131</td>\n",
       "      <td>5879200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02-24</th>\n",
       "      <td>120.800003</td>\n",
       "      <td>123.489998</td>\n",
       "      <td>120.519997</td>\n",
       "      <td>123.209999</td>\n",
       "      <td>120.461708</td>\n",
       "      <td>5820000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02-25</th>\n",
       "      <td>123.370003</td>\n",
       "      <td>124.349998</td>\n",
       "      <td>122.339996</td>\n",
       "      <td>122.470001</td>\n",
       "      <td>119.738220</td>\n",
       "      <td>5691800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02-26</th>\n",
       "      <td>122.250000</td>\n",
       "      <td>122.250000</td>\n",
       "      <td>118.879997</td>\n",
       "      <td>118.930000</td>\n",
       "      <td>116.277176</td>\n",
       "      <td>9051000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-01</th>\n",
       "      <td>120.349998</td>\n",
       "      <td>122.320000</td>\n",
       "      <td>119.860001</td>\n",
       "      <td>120.739998</td>\n",
       "      <td>118.046806</td>\n",
       "      <td>5714500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-03</th>\n",
       "      <td>120.500000</td>\n",
       "      <td>122.629997</td>\n",
       "      <td>119.980003</td>\n",
       "      <td>122.360001</td>\n",
       "      <td>119.630669</td>\n",
       "      <td>7404300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-04</th>\n",
       "      <td>122.000000</td>\n",
       "      <td>123.220001</td>\n",
       "      <td>118.760002</td>\n",
       "      <td>120.110001</td>\n",
       "      <td>117.430855</td>\n",
       "      <td>8068500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-05</th>\n",
       "      <td>120.639999</td>\n",
       "      <td>123.750000</td>\n",
       "      <td>120.250000</td>\n",
       "      <td>122.830002</td>\n",
       "      <td>120.090195</td>\n",
       "      <td>6949300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-08</th>\n",
       "      <td>122.989998</td>\n",
       "      <td>126.849998</td>\n",
       "      <td>122.879997</td>\n",
       "      <td>124.809998</td>\n",
       "      <td>122.026016</td>\n",
       "      <td>7239200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-09</th>\n",
       "      <td>125.400002</td>\n",
       "      <td>126.430000</td>\n",
       "      <td>124.160004</td>\n",
       "      <td>124.180000</td>\n",
       "      <td>121.410080</td>\n",
       "      <td>5609000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-10</th>\n",
       "      <td>125.050003</td>\n",
       "      <td>128.240005</td>\n",
       "      <td>124.610001</td>\n",
       "      <td>127.870003</td>\n",
       "      <td>125.017769</td>\n",
       "      <td>7247800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-18</th>\n",
       "      <td>128.940002</td>\n",
       "      <td>131.000000</td>\n",
       "      <td>127.790001</td>\n",
       "      <td>130.059998</td>\n",
       "      <td>127.158913</td>\n",
       "      <td>5835700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-19</th>\n",
       "      <td>130.020004</td>\n",
       "      <td>130.440002</td>\n",
       "      <td>128.529999</td>\n",
       "      <td>128.899994</td>\n",
       "      <td>126.024788</td>\n",
       "      <td>9845000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-25</th>\n",
       "      <td>130.330002</td>\n",
       "      <td>133.240005</td>\n",
       "      <td>129.770004</td>\n",
       "      <td>133.070007</td>\n",
       "      <td>130.101791</td>\n",
       "      <td>5554000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-26</th>\n",
       "      <td>133.289993</td>\n",
       "      <td>136.479996</td>\n",
       "      <td>133.119995</td>\n",
       "      <td>136.380005</td>\n",
       "      <td>133.337952</td>\n",
       "      <td>5567600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-04-05</th>\n",
       "      <td>133.639999</td>\n",
       "      <td>136.690002</td>\n",
       "      <td>133.399994</td>\n",
       "      <td>135.929993</td>\n",
       "      <td>132.897964</td>\n",
       "      <td>5471300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-04-13</th>\n",
       "      <td>133.000000</td>\n",
       "      <td>133.619995</td>\n",
       "      <td>130.380005</td>\n",
       "      <td>131.179993</td>\n",
       "      <td>128.253922</td>\n",
       "      <td>8033500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-04-14</th>\n",
       "      <td>131.309998</td>\n",
       "      <td>132.779999</td>\n",
       "      <td>130.520004</td>\n",
       "      <td>132.630005</td>\n",
       "      <td>129.671600</td>\n",
       "      <td>5868000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-04-19</th>\n",
       "      <td>133.600006</td>\n",
       "      <td>133.820007</td>\n",
       "      <td>132.580002</td>\n",
       "      <td>133.119995</td>\n",
       "      <td>130.150650</td>\n",
       "      <td>8198600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-04-21</th>\n",
       "      <td>138.059998</td>\n",
       "      <td>143.729996</td>\n",
       "      <td>137.710007</td>\n",
       "      <td>143.550003</td>\n",
       "      <td>140.348007</td>\n",
       "      <td>11909000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-04-22</th>\n",
       "      <td>143.699997</td>\n",
       "      <td>144.740005</td>\n",
       "      <td>141.000000</td>\n",
       "      <td>141.279999</td>\n",
       "      <td>138.128647</td>\n",
       "      <td>7101400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-04-30</th>\n",
       "      <td>143.699997</td>\n",
       "      <td>143.830002</td>\n",
       "      <td>140.550003</td>\n",
       "      <td>141.880005</td>\n",
       "      <td>138.715271</td>\n",
       "      <td>8872200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-05-03</th>\n",
       "      <td>143.809998</td>\n",
       "      <td>145.750000</td>\n",
       "      <td>143.550003</td>\n",
       "      <td>144.750000</td>\n",
       "      <td>141.521240</td>\n",
       "      <td>5733500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-05-04</th>\n",
       "      <td>144.410004</td>\n",
       "      <td>146.589996</td>\n",
       "      <td>144.330002</td>\n",
       "      <td>145.750000</td>\n",
       "      <td>142.498932</td>\n",
       "      <td>6350500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-05-06</th>\n",
       "      <td>145.259995</td>\n",
       "      <td>148.509995</td>\n",
       "      <td>145.179993</td>\n",
       "      <td>148.419998</td>\n",
       "      <td>145.109390</td>\n",
       "      <td>7503500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-05-07</th>\n",
       "      <td>145.919998</td>\n",
       "      <td>146.139999</td>\n",
       "      <td>144.570007</td>\n",
       "      <td>145.460007</td>\n",
       "      <td>143.804413</td>\n",
       "      <td>7003500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-05-10</th>\n",
       "      <td>145.800003</td>\n",
       "      <td>148.380005</td>\n",
       "      <td>145.800003</td>\n",
       "      <td>146.169998</td>\n",
       "      <td>144.506332</td>\n",
       "      <td>6983400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-05-11</th>\n",
       "      <td>144.990005</td>\n",
       "      <td>145.190002</td>\n",
       "      <td>142.899994</td>\n",
       "      <td>144.220001</td>\n",
       "      <td>142.578522</td>\n",
       "      <td>7126400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-05-12</th>\n",
       "      <td>143.839996</td>\n",
       "      <td>144.149994</td>\n",
       "      <td>141.139999</td>\n",
       "      <td>141.300003</td>\n",
       "      <td>139.691757</td>\n",
       "      <td>5959600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-05-27</th>\n",
       "      <td>143.820007</td>\n",
       "      <td>144.770004</td>\n",
       "      <td>143.630005</td>\n",
       "      <td>143.820007</td>\n",
       "      <td>142.183090</td>\n",
       "      <td>5630300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-06-18</th>\n",
       "      <td>144.479996</td>\n",
       "      <td>144.679993</td>\n",
       "      <td>143.039993</td>\n",
       "      <td>143.119995</td>\n",
       "      <td>141.491043</td>\n",
       "      <td>9156500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-07-06</th>\n",
       "      <td>139.990005</td>\n",
       "      <td>140.419998</td>\n",
       "      <td>137.100006</td>\n",
       "      <td>138.779999</td>\n",
       "      <td>137.200439</td>\n",
       "      <td>8093700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-07-08</th>\n",
       "      <td>137.779999</td>\n",
       "      <td>141.309998</td>\n",
       "      <td>137.660004</td>\n",
       "      <td>140.740005</td>\n",
       "      <td>139.138138</td>\n",
       "      <td>5487400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-07-19</th>\n",
       "      <td>136.449997</td>\n",
       "      <td>138.490005</td>\n",
       "      <td>136.210007</td>\n",
       "      <td>137.919998</td>\n",
       "      <td>136.350235</td>\n",
       "      <td>8582300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-09-17</th>\n",
       "      <td>135.750000</td>\n",
       "      <td>135.919998</td>\n",
       "      <td>135.050003</td>\n",
       "      <td>135.229996</td>\n",
       "      <td>135.229996</td>\n",
       "      <td>5631300</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  Open        High         Low       Close   Adj Close  \\\n",
       "Date                                                                     \n",
       "2021-01-05  125.010002  126.680000  124.610001  126.139999  121.700096   \n",
       "2021-01-06  126.900002  131.880005  126.720001  129.289993  124.739220   \n",
       "2021-01-11  127.949997  129.679993  127.660004  128.580002  124.054214   \n",
       "2021-01-13  129.149994  129.750000  126.459999  126.919998  122.452644   \n",
       "2021-01-14  128.020004  130.160004  127.550003  128.970001  124.430489   \n",
       "2021-01-20  129.699997  131.059998  128.559998  130.080002  125.501419   \n",
       "2021-01-21  130.119995  132.240005  130.050003  131.649994  127.016144   \n",
       "2021-01-26  119.180000  122.589996  118.419998  122.489998  118.178566   \n",
       "2021-01-27  122.080002  124.790001  121.620003  122.470001  118.159271   \n",
       "2021-01-28  122.800003  123.199997  120.070000  120.080002  115.853401   \n",
       "2021-01-29  120.220001  121.300003  118.900002  119.110001  114.917534   \n",
       "2021-02-01  119.900002  120.949997  118.730003  120.540001  116.297203   \n",
       "2021-02-02  119.360001  121.000000  119.279999  119.440002  115.235931   \n",
       "2021-02-03  119.040001  119.800003  118.120003  119.120003  114.927193   \n",
       "2021-02-08  122.620003  123.980003  122.400002  123.610001  119.259148   \n",
       "2021-02-16  120.150002  120.599998  119.360001  120.070000  117.391747   \n",
       "2021-02-19  120.750000  120.760002  118.379997  118.989998  116.335838   \n",
       "2021-02-22  118.500000  121.129997  118.440002  120.860001  118.164131   \n",
       "2021-02-24  120.800003  123.489998  120.519997  123.209999  120.461708   \n",
       "2021-02-25  123.370003  124.349998  122.339996  122.470001  119.738220   \n",
       "2021-02-26  122.250000  122.250000  118.879997  118.930000  116.277176   \n",
       "2021-03-01  120.349998  122.320000  119.860001  120.739998  118.046806   \n",
       "2021-03-03  120.500000  122.629997  119.980003  122.360001  119.630669   \n",
       "2021-03-04  122.000000  123.220001  118.760002  120.110001  117.430855   \n",
       "2021-03-05  120.639999  123.750000  120.250000  122.830002  120.090195   \n",
       "2021-03-08  122.989998  126.849998  122.879997  124.809998  122.026016   \n",
       "2021-03-09  125.400002  126.430000  124.160004  124.180000  121.410080   \n",
       "2021-03-10  125.050003  128.240005  124.610001  127.870003  125.017769   \n",
       "2021-03-18  128.940002  131.000000  127.790001  130.059998  127.158913   \n",
       "2021-03-19  130.020004  130.440002  128.529999  128.899994  126.024788   \n",
       "2021-03-25  130.330002  133.240005  129.770004  133.070007  130.101791   \n",
       "2021-03-26  133.289993  136.479996  133.119995  136.380005  133.337952   \n",
       "2021-04-05  133.639999  136.690002  133.399994  135.929993  132.897964   \n",
       "2021-04-13  133.000000  133.619995  130.380005  131.179993  128.253922   \n",
       "2021-04-14  131.309998  132.779999  130.520004  132.630005  129.671600   \n",
       "2021-04-19  133.600006  133.820007  132.580002  133.119995  130.150650   \n",
       "2021-04-21  138.059998  143.729996  137.710007  143.550003  140.348007   \n",
       "2021-04-22  143.699997  144.740005  141.000000  141.279999  138.128647   \n",
       "2021-04-30  143.699997  143.830002  140.550003  141.880005  138.715271   \n",
       "2021-05-03  143.809998  145.750000  143.550003  144.750000  141.521240   \n",
       "2021-05-04  144.410004  146.589996  144.330002  145.750000  142.498932   \n",
       "2021-05-06  145.259995  148.509995  145.179993  148.419998  145.109390   \n",
       "2021-05-07  145.919998  146.139999  144.570007  145.460007  143.804413   \n",
       "2021-05-10  145.800003  148.380005  145.800003  146.169998  144.506332   \n",
       "2021-05-11  144.990005  145.190002  142.899994  144.220001  142.578522   \n",
       "2021-05-12  143.839996  144.149994  141.139999  141.300003  139.691757   \n",
       "2021-05-27  143.820007  144.770004  143.630005  143.820007  142.183090   \n",
       "2021-06-18  144.479996  144.679993  143.039993  143.119995  141.491043   \n",
       "2021-07-06  139.990005  140.419998  137.100006  138.779999  137.200439   \n",
       "2021-07-08  137.779999  141.309998  137.660004  140.740005  139.138138   \n",
       "2021-07-19  136.449997  138.490005  136.210007  137.919998  136.350235   \n",
       "2021-09-17  135.750000  135.919998  135.050003  135.229996  135.229996   \n",
       "\n",
       "              Volume  \n",
       "Date                  \n",
       "2021-01-05   6114600  \n",
       "2021-01-06   7956700  \n",
       "2021-01-11   5601900  \n",
       "2021-01-13   7677700  \n",
       "2021-01-14   7503200  \n",
       "2021-01-20   5598700  \n",
       "2021-01-21  12539200  \n",
       "2021-01-26  10694700  \n",
       "2021-01-27  12146500  \n",
       "2021-01-28   8084100  \n",
       "2021-01-29  11825500  \n",
       "2021-02-01   6250500  \n",
       "2021-02-02   6341900  \n",
       "2021-02-03   6715400  \n",
       "2021-02-08   5888000  \n",
       "2021-02-16   6639800  \n",
       "2021-02-19   6578700  \n",
       "2021-02-22   5879200  \n",
       "2021-02-24   5820000  \n",
       "2021-02-25   5691800  \n",
       "2021-02-26   9051000  \n",
       "2021-03-01   5714500  \n",
       "2021-03-03   7404300  \n",
       "2021-03-04   8068500  \n",
       "2021-03-05   6949300  \n",
       "2021-03-08   7239200  \n",
       "2021-03-09   5609000  \n",
       "2021-03-10   7247800  \n",
       "2021-03-18   5835700  \n",
       "2021-03-19   9845000  \n",
       "2021-03-25   5554000  \n",
       "2021-03-26   5567600  \n",
       "2021-04-05   5471300  \n",
       "2021-04-13   8033500  \n",
       "2021-04-14   5868000  \n",
       "2021-04-19   8198600  \n",
       "2021-04-21  11909000  \n",
       "2021-04-22   7101400  \n",
       "2021-04-30   8872200  \n",
       "2021-05-03   5733500  \n",
       "2021-05-04   6350500  \n",
       "2021-05-06   7503500  \n",
       "2021-05-07   7003500  \n",
       "2021-05-10   6983400  \n",
       "2021-05-11   7126400  \n",
       "2021-05-12   5959600  \n",
       "2021-05-27   5630300  \n",
       "2021-06-18   9156500  \n",
       "2021-07-06   8093700  \n",
       "2021-07-08   5487400  \n",
       "2021-07-19   8582300  \n",
       "2021-09-17   5631300  "
      ]
     },
     "execution_count": 127,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_SQL = my_Base_SQL + \" WHERE Volume BETWEEN  %s AND %s;\"\n",
    "pysqldf(my_SQL % (\n",
    "    str(my_monly_stats2[0]-0.5 *my_monly_stats2[1]),my_monly_stats2[0]+0.5 *my_monly_stats2[1])).set_index([\"Date\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 128,
   "id": "a794d394-bcde-4d4a-8452-baa64d098147",
   "metadata": {},
   "outputs": [
    {
     "ename": "SyntaxError",
     "evalue": "invalid syntax (3326763516.py, line 1)",
     "output_type": "error",
     "traceback": [
      "\u001b[0;36m  File \u001b[0;32m\"/var/folders/hf/5tnp05ns7598nz_smm6l10tm0000gn/T/ipykernel_12388/3326763516.py\"\u001b[0;36m, line \u001b[0;32m1\u001b[0m\n\u001b[0;31m    Between 夾在這兩個條件之間\u001b[0m\n\u001b[0m            ^\u001b[0m\n\u001b[0;31mSyntaxError\u001b[0m\u001b[0;31m:\u001b[0m invalid syntax\n"
     ]
    }
   ],
   "source": [
    "Between 夾在這兩個條件之間"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 129,
   "id": "6bd99f13-fa7f-42a3-810e-684b4e98bd84",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Open</th>\n",
       "      <th>High</th>\n",
       "      <th>Low</th>\n",
       "      <th>Close</th>\n",
       "      <th>Adj Close</th>\n",
       "      <th>Volume</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2021-01-21</th>\n",
       "      <td>130.119995</td>\n",
       "      <td>132.240005</td>\n",
       "      <td>130.050003</td>\n",
       "      <td>131.649994</td>\n",
       "      <td>127.016144</td>\n",
       "      <td>12539200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03-19</th>\n",
       "      <td>130.020004</td>\n",
       "      <td>130.440002</td>\n",
       "      <td>128.529999</td>\n",
       "      <td>128.899994</td>\n",
       "      <td>126.024788</td>\n",
       "      <td>9845000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-04-21</th>\n",
       "      <td>138.059998</td>\n",
       "      <td>143.729996</td>\n",
       "      <td>137.710007</td>\n",
       "      <td>143.550003</td>\n",
       "      <td>140.348007</td>\n",
       "      <td>11909000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  Open        High         Low       Close   Adj Close  \\\n",
       "Date                                                                     \n",
       "2021-01-21  130.119995  132.240005  130.050003  131.649994  127.016144   \n",
       "2021-03-19  130.020004  130.440002  128.529999  128.899994  126.024788   \n",
       "2021-04-21  138.059998  143.729996  137.710007  143.550003  140.348007   \n",
       "\n",
       "              Volume  \n",
       "Date                  \n",
       "2021-01-21  12539200  \n",
       "2021-03-19   9845000  \n",
       "2021-04-21  11909000  "
      ]
     },
     "execution_count": 129,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_SQL = my_Base_SQL + \" WHERE (Open BETWEEN %s AND %s) AND(Volume BETWEEN %s AND %s);\"\n",
    "pysqldf(my_SQL % (\n",
    "    str(my_monly_stats[0]-0.5 *my_monly_stats[1]),\n",
    "    str(my_monly_stats[0]+0.5 *my_monly_stats2[1]),\n",
    "    str(my_monly_stats2[0]-0.5 *my_monly_stats[1]),\n",
    "    str(my_monly_stats2[0]+0.5 *my_monly_stats2[1]))).set_index([\"Date\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 130,
   "id": "b502c4ed-375e-448e-a5d6-8211d35bf07a",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Open</th>\n",
       "      <th>High</th>\n",
       "      <th>Low</th>\n",
       "      <th>Close</th>\n",
       "      <th>Adj Close</th>\n",
       "      <th>Volume</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2021-01-26</th>\n",
       "      <td>119.180000</td>\n",
       "      <td>122.589996</td>\n",
       "      <td>118.419998</td>\n",
       "      <td>122.489998</td>\n",
       "      <td>118.178566</td>\n",
       "      <td>10694700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-27</th>\n",
       "      <td>122.080002</td>\n",
       "      <td>124.790001</td>\n",
       "      <td>121.620003</td>\n",
       "      <td>122.470001</td>\n",
       "      <td>118.159271</td>\n",
       "      <td>12146500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-29</th>\n",
       "      <td>120.220001</td>\n",
       "      <td>121.300003</td>\n",
       "      <td>118.900002</td>\n",
       "      <td>119.110001</td>\n",
       "      <td>114.917534</td>\n",
       "      <td>11825500</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  Open        High         Low       Close   Adj Close  \\\n",
       "Date                                                                     \n",
       "2021-01-26  119.180000  122.589996  118.419998  122.489998  118.178566   \n",
       "2021-01-27  122.080002  124.790001  121.620003  122.470001  118.159271   \n",
       "2021-01-29  120.220001  121.300003  118.900002  119.110001  114.917534   \n",
       "\n",
       "              Volume  \n",
       "Date                  \n",
       "2021-01-26  10694700  \n",
       "2021-01-27  12146500  \n",
       "2021-01-29  11825500  "
      ]
     },
     "execution_count": 130,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_SQL = my_Base_SQL + \" WHERE NOT(Open BETWEEN %s AND %s) AND (Volume BETWEEN %s AND %s);\"\n",
    "pysqldf(my_SQL % (\n",
    "    str(my_monly_stats[0]-0.5 *my_monly_stats[1]),\n",
    "    str(my_monly_stats[0]+0.5 *my_monly_stats2[1]),\n",
    "    str(my_monly_stats2[0]-0.5 *my_monly_stats[1]),\n",
    "    str(my_monly_stats2[0]+0.5 *my_monly_stats2[1]))).set_index([\"Date\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 131,
   "id": "73db4af9-4082-4125-9ebc-010b8131a029",
   "metadata": {},
   "outputs": [
    {
     "ename": "SyntaxError",
     "evalue": "invalid syntax (1635123592.py, line 1)",
     "output_type": "error",
     "traceback": [
      "\u001b[0;36m  File \u001b[0;32m\"/var/folders/hf/5tnp05ns7598nz_smm6l10tm0000gn/T/ipykernel_12388/1635123592.py\"\u001b[0;36m, line \u001b[0;32m1\u001b[0m\n\u001b[0;31m    差集合 (not open...)or(not volume...) NOT(Open BETWEEN %s AND %s) AND (Volume BETWEEN %s AND %s) 一樣意思\u001b[0m\n\u001b[0m                 ^\u001b[0m\n\u001b[0;31mSyntaxError\u001b[0m\u001b[0;31m:\u001b[0m invalid syntax\n"
     ]
    }
   ],
   "source": [
    "差集合 (not open...)or(not volume...) NOT(Open BETWEEN %s AND %s) AND (Volume BETWEEN %s AND %s) 一樣意思"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 132,
   "id": "0c9ea8aa-fd95-422c-80ef-ee4dc7f64a59",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Open</th>\n",
       "      <th>High</th>\n",
       "      <th>Low</th>\n",
       "      <th>Close</th>\n",
       "      <th>Adj Close</th>\n",
       "      <th>Volume</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2021-01-04</th>\n",
       "      <td>125.849998</td>\n",
       "      <td>125.919998</td>\n",
       "      <td>123.040001</td>\n",
       "      <td>123.940002</td>\n",
       "      <td>119.577530</td>\n",
       "      <td>5179200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-05</th>\n",
       "      <td>125.010002</td>\n",
       "      <td>126.680000</td>\n",
       "      <td>124.610001</td>\n",
       "      <td>126.139999</td>\n",
       "      <td>121.700096</td>\n",
       "      <td>6114600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-06</th>\n",
       "      <td>126.900002</td>\n",
       "      <td>131.880005</td>\n",
       "      <td>126.720001</td>\n",
       "      <td>129.289993</td>\n",
       "      <td>124.739220</td>\n",
       "      <td>7956700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-07</th>\n",
       "      <td>130.039993</td>\n",
       "      <td>130.460007</td>\n",
       "      <td>128.259995</td>\n",
       "      <td>128.990005</td>\n",
       "      <td>124.449783</td>\n",
       "      <td>4507400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-01-08</th>\n",
       "      <td>128.570007</td>\n",
       "      <td>129.320007</td>\n",
       "      <td>126.980003</td>\n",
       "      <td>128.529999</td>\n",
       "      <td>124.005974</td>\n",
       "      <td>4676200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-09-15</th>\n",
       "      <td>136.220001</td>\n",
       "      <td>137.800003</td>\n",
       "      <td>135.669998</td>\n",
       "      <td>137.199997</td>\n",
       "      <td>137.199997</td>\n",
       "      <td>3253900</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-09-16</th>\n",
       "      <td>137.279999</td>\n",
       "      <td>137.949997</td>\n",
       "      <td>135.710007</td>\n",
       "      <td>136.429993</td>\n",
       "      <td>136.429993</td>\n",
       "      <td>2644000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-09-17</th>\n",
       "      <td>135.750000</td>\n",
       "      <td>135.919998</td>\n",
       "      <td>135.050003</td>\n",
       "      <td>135.229996</td>\n",
       "      <td>135.229996</td>\n",
       "      <td>5631300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-09-20</th>\n",
       "      <td>133.899994</td>\n",
       "      <td>135.179993</td>\n",
       "      <td>132.779999</td>\n",
       "      <td>134.309998</td>\n",
       "      <td>134.309998</td>\n",
       "      <td>4770700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-09-21</th>\n",
       "      <td>135.110001</td>\n",
       "      <td>135.639999</td>\n",
       "      <td>132.869995</td>\n",
       "      <td>132.970001</td>\n",
       "      <td>132.970001</td>\n",
       "      <td>4042768</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>153 rows × 6 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                  Open        High         Low       Close   Adj Close  \\\n",
       "Date                                                                     \n",
       "2021-01-04  125.849998  125.919998  123.040001  123.940002  119.577530   \n",
       "2021-01-05  125.010002  126.680000  124.610001  126.139999  121.700096   \n",
       "2021-01-06  126.900002  131.880005  126.720001  129.289993  124.739220   \n",
       "2021-01-07  130.039993  130.460007  128.259995  128.990005  124.449783   \n",
       "2021-01-08  128.570007  129.320007  126.980003  128.529999  124.005974   \n",
       "...                ...         ...         ...         ...         ...   \n",
       "2021-09-15  136.220001  137.800003  135.669998  137.199997  137.199997   \n",
       "2021-09-16  137.279999  137.949997  135.710007  136.429993  136.429993   \n",
       "2021-09-17  135.750000  135.919998  135.050003  135.229996  135.229996   \n",
       "2021-09-20  133.899994  135.179993  132.779999  134.309998  134.309998   \n",
       "2021-09-21  135.110001  135.639999  132.869995  132.970001  132.970001   \n",
       "\n",
       "             Volume  \n",
       "Date                 \n",
       "2021-01-04  5179200  \n",
       "2021-01-05  6114600  \n",
       "2021-01-06  7956700  \n",
       "2021-01-07  4507400  \n",
       "2021-01-08  4676200  \n",
       "...             ...  \n",
       "2021-09-15  3253900  \n",
       "2021-09-16  2644000  \n",
       "2021-09-17  5631300  \n",
       "2021-09-20  4770700  \n",
       "2021-09-21  4042768  \n",
       "\n",
       "[153 rows x 6 columns]"
      ]
     },
     "execution_count": 132,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_SQL = my_Base_SQL + \" WHERE (Open BETWEEN %s AND %s) OR (Volume BETWEEN %s AND %s);\"\n",
    "pysqldf(my_SQL % (\n",
    "    str(my_monly_stats[0]-0.5 *my_monly_stats[1]),\n",
    "    str(my_monly_stats[0]+0.5 *my_monly_stats2[1]),\n",
    "    str(my_monly_stats2[0]-0.5 *my_monly_stats[1]),\n",
    "    str(my_monly_stats2[0]+0.5 *my_monly_stats2[1]))).set_index([\"Date\"])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "51f83992-958c-4df9-9929-b2e3aaa707e6",
   "metadata": {},
   "source": [
    "連集"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 136,
   "id": "2ae68fef-6f9b-468d-b080-e48eeb47d3f6",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Open</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>YM</th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2021-01</th>\n",
       "      <td>130.119995</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-02</th>\n",
       "      <td>123.370003</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-03</th>\n",
       "      <td>135.979996</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-04</th>\n",
       "      <td>144.130005</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-05</th>\n",
       "      <td>145.940002</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-06</th>\n",
       "      <td>151.470001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-07</th>\n",
       "      <td>146.960007</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-08</th>\n",
       "      <td>143.800003</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-09</th>\n",
       "      <td>139.979996</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "               Open\n",
       "YM                 \n",
       "2021-01  130.119995\n",
       "2021-02  123.370003\n",
       "2021-03  135.979996\n",
       "2021-04  144.130005\n",
       "2021-05  145.940002\n",
       "2021-06  151.470001\n",
       "2021-07  146.960007\n",
       "2021-08  143.800003\n",
       "2021-09  139.979996"
      ]
     },
     "execution_count": 136,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "my_SQL='SELECT SUBSTR(Date, 1, 7) AS YM, MAX(Open) AS Open FROM dataframe_2k GROUP BY SUBSTR(Date, 1, 7);'\n",
    "pysqldf(my_SQL).set_index(['YM'])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dd1b8751-9e0c-4c15-89e4-8212dcfaf045",
   "metadata": {},
   "source": [
    "新的欄位 YM 撈年份跟月份的資料 每個月份的各自最大值 顯現出MAX出來  GROUP BY "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "64ca0624-cb47-4c1c-8bff-1f1f154fb298",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "ddfa4e86-3a06-4966-a53f-be98e296ace5",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 112,
   "id": "f2f01dca-f5f3-49a7-93da-51e71e3afaa1",
   "metadata": {},
   "outputs": [
    {
     "ename": "PandaSQLException",
     "evalue": "(sqlite3.OperationalError) no such table: dataframe_2K\n[SQL: SELECT * FROM dataframe_2K A INNER JOIN ( SELECT SUBSTR(Date, 1, 7) AS YM, MAX(Open) AS Open FROM dataframe_2K GROUP BY SUBSTR(Date, 1, 7)) B ON A.Open = B.Open]\n(Background on this error at: https://sqlalche.me/e/14/e3q8)",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mOperationalError\u001b[0m                          Traceback (most recent call last)",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/sqlalchemy/engine/base.py\u001b[0m in \u001b[0;36m_execute_context\u001b[0;34m(self, dialect, constructor, statement, parameters, execution_options, *args, **kw)\u001b[0m\n\u001b[1;32m   1770\u001b[0m                 \u001b[0;32mif\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0mevt_handled\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1771\u001b[0;31m                     self.dialect.do_execute(\n\u001b[0m\u001b[1;32m   1772\u001b[0m                         \u001b[0mcursor\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mstatement\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mparameters\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcontext\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/sqlalchemy/engine/default.py\u001b[0m in \u001b[0;36mdo_execute\u001b[0;34m(self, cursor, statement, parameters, context)\u001b[0m\n\u001b[1;32m    716\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0mdo_execute\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcursor\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mstatement\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mparameters\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcontext\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mNone\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 717\u001b[0;31m         \u001b[0mcursor\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mexecute\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mstatement\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mparameters\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    718\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;31mOperationalError\u001b[0m: no such table: dataframe_2K",
      "\nThe above exception was the direct cause of the following exception:\n",
      "\u001b[0;31mOperationalError\u001b[0m                          Traceback (most recent call last)",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/pandasql/sqldf.py\u001b[0m in \u001b[0;36m__call__\u001b[0;34m(self, query, env)\u001b[0m\n\u001b[1;32m     60\u001b[0m             \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 61\u001b[0;31m                 \u001b[0mresult\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mread_sql\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mquery\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mconn\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     62\u001b[0m             \u001b[0;32mexcept\u001b[0m \u001b[0mDatabaseError\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0mex\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/pandas/io/sql.py\u001b[0m in \u001b[0;36mread_sql\u001b[0;34m(sql, con, index_col, coerce_float, params, parse_dates, columns, chunksize)\u001b[0m\n\u001b[1;32m    627\u001b[0m     \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 628\u001b[0;31m         return pandas_sql.read_query(\n\u001b[0m\u001b[1;32m    629\u001b[0m             \u001b[0msql\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/pandas/io/sql.py\u001b[0m in \u001b[0;36mread_query\u001b[0;34m(self, sql, index_col, coerce_float, parse_dates, params, chunksize, dtype)\u001b[0m\n\u001b[1;32m   1578\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1579\u001b[0;31m         \u001b[0mresult\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mexecute\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0margs\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   1580\u001b[0m         \u001b[0mcolumns\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mresult\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mkeys\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/pandas/io/sql.py\u001b[0m in \u001b[0;36mexecute\u001b[0;34m(self, *args, **kwargs)\u001b[0m\n\u001b[1;32m   1423\u001b[0m         \u001b[0;34m\"\"\"Simple passthrough to SQLAlchemy connectable\"\"\"\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1424\u001b[0;31m         \u001b[0;32mreturn\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mconnectable\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mexecution_options\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mexecute\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0margs\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkwargs\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   1425\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/sqlalchemy/engine/base.py\u001b[0m in \u001b[0;36mexecute\u001b[0;34m(self, statement, *multiparams, **params)\u001b[0m\n\u001b[1;32m   1247\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1248\u001b[0;31m             return self._exec_driver_sql(\n\u001b[0m\u001b[1;32m   1249\u001b[0m                 \u001b[0mstatement\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/sqlalchemy/engine/base.py\u001b[0m in \u001b[0;36m_exec_driver_sql\u001b[0;34m(self, statement, multiparams, params, execution_options, future)\u001b[0m\n\u001b[1;32m   1546\u001b[0m         \u001b[0mdialect\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdialect\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1547\u001b[0;31m         ret = self._execute_context(\n\u001b[0m\u001b[1;32m   1548\u001b[0m             \u001b[0mdialect\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/sqlalchemy/engine/base.py\u001b[0m in \u001b[0;36m_execute_context\u001b[0;34m(self, dialect, constructor, statement, parameters, execution_options, *args, **kw)\u001b[0m\n\u001b[1;32m   1813\u001b[0m         \u001b[0;32mexcept\u001b[0m \u001b[0mBaseException\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1814\u001b[0;31m             self._handle_dbapi_exception(\n\u001b[0m\u001b[1;32m   1815\u001b[0m                 \u001b[0me\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mstatement\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mparameters\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcursor\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcontext\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/sqlalchemy/engine/base.py\u001b[0m in \u001b[0;36m_handle_dbapi_exception\u001b[0;34m(self, e, statement, parameters, cursor, context)\u001b[0m\n\u001b[1;32m   1994\u001b[0m             \u001b[0;32melif\u001b[0m \u001b[0mshould_wrap\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1995\u001b[0;31m                 util.raise_(\n\u001b[0m\u001b[1;32m   1996\u001b[0m                     \u001b[0msqlalchemy_exception\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mwith_traceback\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mexc_info\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;36m2\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mfrom_\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0me\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/sqlalchemy/util/compat.py\u001b[0m in \u001b[0;36mraise_\u001b[0;34m(***failed resolving arguments***)\u001b[0m\n\u001b[1;32m    206\u001b[0m         \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 207\u001b[0;31m             \u001b[0;32mraise\u001b[0m \u001b[0mexception\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    208\u001b[0m         \u001b[0;32mfinally\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/sqlalchemy/engine/base.py\u001b[0m in \u001b[0;36m_execute_context\u001b[0;34m(self, dialect, constructor, statement, parameters, execution_options, *args, **kw)\u001b[0m\n\u001b[1;32m   1770\u001b[0m                 \u001b[0;32mif\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0mevt_handled\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1771\u001b[0;31m                     self.dialect.do_execute(\n\u001b[0m\u001b[1;32m   1772\u001b[0m                         \u001b[0mcursor\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mstatement\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mparameters\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcontext\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/sqlalchemy/engine/default.py\u001b[0m in \u001b[0;36mdo_execute\u001b[0;34m(self, cursor, statement, parameters, context)\u001b[0m\n\u001b[1;32m    716\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0mdo_execute\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcursor\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mstatement\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mparameters\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcontext\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mNone\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 717\u001b[0;31m         \u001b[0mcursor\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mexecute\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mstatement\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mparameters\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    718\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;31mOperationalError\u001b[0m: (sqlite3.OperationalError) no such table: dataframe_2K\n[SQL: SELECT * FROM dataframe_2K A INNER JOIN ( SELECT SUBSTR(Date, 1, 7) AS YM, MAX(Open) AS Open FROM dataframe_2K GROUP BY SUBSTR(Date, 1, 7)) B ON A.Open = B.Open]\n(Background on this error at: https://sqlalche.me/e/14/e3q8)",
      "\nDuring handling of the above exception, another exception occurred:\n",
      "\u001b[0;31mPandaSQLException\u001b[0m                         Traceback (most recent call last)",
      "\u001b[0;32m/var/folders/hf/5tnp05ns7598nz_smm6l10tm0000gn/T/ipykernel_12388/3697031727.py\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m      6\u001b[0m ]\n\u001b[1;32m      7\u001b[0m \u001b[0mmy_SQL\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m' '\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mjoin\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mmy_SQL\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 8\u001b[0;31m \u001b[0mpysqldf\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mmy_SQL\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m",
      "\u001b[0;32m/var/folders/hf/5tnp05ns7598nz_smm6l10tm0000gn/T/ipykernel_12388/3768727300.py\u001b[0m in \u001b[0;36m<lambda>\u001b[0;34m(q)\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[0;32mfrom\u001b[0m \u001b[0mpandasql\u001b[0m \u001b[0;32mimport\u001b[0m \u001b[0msqldf\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 2\u001b[0;31m \u001b[0mpysqldf\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;32mlambda\u001b[0m \u001b[0mq\u001b[0m \u001b[0;34m:\u001b[0m \u001b[0msqldf\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mq\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mglobals\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/pandasql/sqldf.py\u001b[0m in \u001b[0;36msqldf\u001b[0;34m(query, env, db_uri)\u001b[0m\n\u001b[1;32m    154\u001b[0m     \u001b[0;34m>>\u001b[0m\u001b[0;34m>\u001b[0m \u001b[0msqldf\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"select avg(x) from df;\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mlocals\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    155\u001b[0m     \"\"\"\n\u001b[0;32m--> 156\u001b[0;31m     \u001b[0;32mreturn\u001b[0m \u001b[0mPandaSQL\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdb_uri\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mquery\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0menv\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m",
      "\u001b[0;32m~/opt/anaconda3/envs/DB/lib/python3.8/site-packages/pandasql/sqldf.py\u001b[0m in \u001b[0;36m__call__\u001b[0;34m(self, query, env)\u001b[0m\n\u001b[1;32m     61\u001b[0m                 \u001b[0mresult\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mread_sql\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mquery\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mconn\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     62\u001b[0m             \u001b[0;32mexcept\u001b[0m \u001b[0mDatabaseError\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0mex\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 63\u001b[0;31m                 \u001b[0;32mraise\u001b[0m \u001b[0mPandaSQLException\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mex\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     64\u001b[0m             \u001b[0;32mexcept\u001b[0m \u001b[0mResourceClosedError\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     65\u001b[0m                 \u001b[0;31m# query returns nothing\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;31mPandaSQLException\u001b[0m: (sqlite3.OperationalError) no such table: dataframe_2K\n[SQL: SELECT * FROM dataframe_2K A INNER JOIN ( SELECT SUBSTR(Date, 1, 7) AS YM, MAX(Open) AS Open FROM dataframe_2K GROUP BY SUBSTR(Date, 1, 7)) B ON A.Open = B.Open]\n(Background on this error at: https://sqlalche.me/e/14/e3q8)"
     ]
    }
   ],
   "source": [
    "my_SQL = [\n",
    "    'SELECT * FROM dataframe_2K A',\n",
    "    'INNER JOIN (',\n",
    "    'SELECT SUBSTR(Date, 1, 7) AS YM, MAX(Open) AS Open FROM dataframe_2K GROUP BY SUBSTR(Date, 1, 7)) B',\n",
    "    'ON A.Open = B.Open'\n",
    "]\n",
    "my_SQL = ' '.join(my_SQL)\n",
    "pysqldf(my_SQL)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "12ead2cb-fb4b-4897-9c77-3bbd4162ec30",
   "metadata": {},
   "outputs": [],
   "source": [
    "on誰的欄位 ＝ 什麼的欄位 不打A 需要打 dataframe_2K"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1de50dc1-4531-448c-a5ae-adaea0a90900",
   "metadata": {},
   "outputs": [],
   "source": [
    "my_SQL = ' '.join(my_SQL)\n",
    "my_SQL"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "61cfa622-cadc-4570-a736-e1419f143ab5",
   "metadata": {},
   "outputs": [],
   "source": [
    "dataframe_2k[\"Net\"]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "968040d2-8cbd-42d7-b036-0a87f8064ff9",
   "metadata": {},
   "outputs": [],
   "source": [
    " = numpy.abs(dataframe_2k[\"Adj Close\"] - dataframe_2k['Open'])\n",
    "\n",
    "my_SQL = [\n",
    "    'SELECT * FROM dataframe_2K A',\n",
    "    'INNER JOIN (',\n",
    "    'SELECT SUBSTR(Date, 1, 7) AS YM, MAX(Open) AS Open FROM dataframe_2K GROUP BY SUBSTR(Date, 1, 7)) B',\n",
    "    'ON A.Net = B.Net'\n",
    "]\n",
    "my_SQL = ' '.join(my_SQL)\n",
    "pysqldf(my_SQL)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.11"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
